FROM registry.access.redhat.com/openshift3/apb-base 

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG1zc3FsLWFwYgpkZXNjcmlwdGlvbjogTWljcm9zb2Z0IFNRTCBT\
ZXJ2ZXIgUmVtb3RlIEFQQiAKYmluZGFibGU6IFRydWUKYXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRh\
OgogIGRpc3BsYXlOYW1lOiAiTVMgU1FMIFNlcnZlciAtIFJlbW90ZSIKICBpbWFnZVVybDogaHR0\
cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1ZlZXJNdWNoYW5kaS9Vc2luZy1PcGVuU2hp\
ZnQtQVBCL21hc3Rlci9tc3NxbC1yaGVsL1NRTC1TZXJ2ZXIucG5nCiAgbG9uZ0Rlc2NyaXB0aW9u\
OiAiQW4gQW5zaWJsZSBQbGF5Ym9vayBCdW5kbGUgKEFQQikgdGhhdCBkZXBsb3lzIGEgZGF0YWJh\
c2Ugb24gYW4gZXhpc3RpbmcgTVMgU1FMIFNlcnZlciBjb25maWd1cmVkIGZvciBjb250YWluZWQg\
ZGF0YWJhc2VzIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJSZWQgSGF0LCBJbmMuIiAKcGxhbnM6\
CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYSBk\
YXRhYmFzZSBvbiB5b3VyIG93biBpbnN0YW5jZSBvZiBNUyBTUUxTZXJ2ZXIuIFVzZSB0aGlzIEFQ\
QiB3aGVuIHlvdSB3YW50IHRvIHByb3Zpc2lvbiBhIGRhdGFiYXNlIG9uIHlvdXIgb3duIGRhdGFi\
YXNlIHNlcnZlci4gIFlvdSB3aWxsIHN1cHBseSBjb25uZWN0aW9uIGluZm9ybWF0aW9uIHRvIHlv\
dXIgZGF0YWJhc2UgaW4gdGhlIG5leHQgc3RlcC4gWW91ciBNUyBTUUxTZXJ2ZXIgc2hvdWxkIGhh\
dmUgYmVlbiBjb25maWd1cmVkIHRvIHN1cHBvcnQgY29udGFpbmVkIGRhdGFiYXNlcyBhcyBleHBs\
YWluZWQgaGVyZSBodHRwczovL3d3dy5tc3NxbHRpcHMuY29tL3NxbHNlcnZlcnRpcC8yNDI4L3Nx\
bC1zZXJ2ZXItMjAxMi1jb250YWluZWQtZGF0YWJhc2UtZmVhdHVyZS8KICAgIGZyZWU6IFRydWUK\
ICAgIG1ldGFkYXRhOiAKICAgICAgZGlzcGxheU5hbWU6IE1TIFNRTCBTZXJ2ZXIKICAgICAgbG9u\
Z0Rlc2NyaXB0aW9uOiBQcm92aWRlIHlvdXIgc2VydmVyIGNvbm5lY3Rpb24gaW5mb3JtYXRpb24s\
IGFuZCB0aGUgZGF0YWJhc2UgYW5kIHVzZXIgdG8gYWRkLiBSZWZlciBQYXNzd29yZCBQb2xpY2ll\
cyBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvcmVsYXRpb25hbC1kYXRhYmFz\
ZXMvc2VjdXJpdHkvcGFzc3dvcmQtcG9saWN5I3Bhc3N3b3JkLWNvbXBsZXhpdHkKICAgIHBhcmFt\
ZXRlcnM6CiAgICAgIC0gbmFtZTogbXNzcWxfZGF0YWJhc2UKICAgICAgICB0aXRsZTogTmFtZSBv\
ZiB0aGUgZGF0YWJhc2UgdG8gYmUgcHJvdmlzaW9uZWQgCiAgICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgICAgZGVmYXVsdDogc2FtcGxlZGIKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVpfXVthLXpB\
LVowLTlfXSokIgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gbmFtZTogbXNzcWxfaG9z\
dAogICAgICAgIHRpdGxlOiBIb3N0IHJ1bm5pbmcgTVMgU1FMIFNlcnZlciAKICAgICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIG5hbWU6IG1zc3FsX3BvcnQK\
ICAgICAgICB0aXRsZTogUG9ydCBNUyBTUUwgU2VydmVyIGlzIGV4cG9zZWQgb24KICAgICAgICB0\
eXBlOiBpbnQgCiAgICAgICAgZGVmYXVsdDogMTQzMyAKICAgICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICAtIG5hbWU6IG1zc3FsX2FkbWluX3VzZXIKICAgICAgICB0aXRsZTogTVNTUUwgQWRtaW4g\
VXNlcgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IFNBIAogICAgICAgIHJl\
cXVpcmVkOiB0cnVlCiAgICAgICAgbWF4bGVuZ3RoOiAxMjgKICAgICAgLSBuYW1lOiBtc3NxbF9h\
ZG1pbl9wYXNzd29yZAogICAgICAgIHRpdGxlOiBNU1NRTCBBZG1pbiBQYXNzd29yZAogICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBl\
OiBwYXNzd29yZAogICAgICAgIG1heGxlbmd0aDogMTI4CiAgICAgICAgcGF0dGVybjogIl5bYS16\
QS1aMC05X34hQCMkJV4mKigpLT08PiwuPzs6fF0rJCIKICAgICAgLSBuYW1lOiBtc3NxbF91c2Vy\
CiAgICAgICAgdGl0bGU6IERhdGFiYXNlIHVzZXIgdG8gYmUgYWRkZWQgdG8gY29ubmVjdCBpbiB0\
aGUgZnV0dXJlIAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IG1zc3FsdXNl\
cgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgbWF4bGVuZ3RoOiAxMjgKICAgICAgLSBu\
YW1lOiBtc3NxbF9wYXNzd29yZAogICAgICAgIHRpdGxlOiBQYXNzd29yZCBmb3IgdGhlIGRhdGFi\
YXNlIHVzZXIgYmVpbmcgYWRkZWQKICAgICAgICBkZWZhdWx0OiBNU1NRTFBhc3N3b3JkMQogICAg\
ICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBy\
ZXF1aXJlZDogdHJ1ZQogICAgICAgIG1pbmxlbmd0aDogOCAgIAogICAgICAgIG1heGxlbmd0aDog\
MTI4CiAgICAgICAgcGF0dGVybjogIl5bYS16QS1aMC05X34hQCMkJV4mKigpLT08PiwuPzs6fF0r\
JCIKICAgICAgLSBuYW1lOiBwb3N0aW5zdGFsbF9tc3NxbF9zY3JpcHQKICAgICAgICB0aXRsZTog\
VVJMIG9mIHRoZSBzY3JpcHQgdG8gcnVuIGFmdGVyIGRhdGFiYXNlIGNyZWF0aW9uIChvcHRpb25h\
bCkKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UK"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN rpm -ivh http://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm && yum -y install python-pip && pip install pymssql && yum clean all -y
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
