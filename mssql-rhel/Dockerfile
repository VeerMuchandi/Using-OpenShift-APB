FROM registry.access.redhat.com/openshift3/apb-base 

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG1zc3FsLXJoZWwtYXBiCmRlc2NyaXB0aW9uOiBNaWNyb3NvZnQg\
U1FMIFNlcnZlciBvbiBSSEVMICAgICAgICAgICAgICAgICAgICAgICAKYmluZGFibGU6IFRydWUK\
YXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBtc3NxbC1yaGVsCnBsYW5z\
OgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IFRoaXMgcGxhbiBkZXBsb3lzIGEg\
ZGF0YWJhc2Ugb24gdGhlIGRldmVsb3BtZW50IHZlcnNpb24gb2YgTVMgU1FMU2VydmVyLiBUaGlz\
IE1TIFNRTFNlcnZlciBpbnN0YW5jZSBzaG91bGQgaGF2ZSBiZWVuIGNvbmZpZ3VyZWQgdG8gc3Vw\
cG9ydCBjb250YWluZWQgZGF0YWJhc2VzIGFzIGV4cGxhaW5lZCBoZXJlIGh0dHBzOi8vd3d3Lm1z\
c3FsdGlwcy5jb20vc3Fsc2VydmVydGlwLzI0Mjgvc3FsLXNlcnZlci0yMDEyLWNvbnRhaW5lZC1k\
YXRhYmFzZS1mZWF0dXJlLwogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJh\
bWV0ZXJzOgogICAgICAtIG5hbWU6IG1zc3FsX2RhdGFiYXNlCiAgICAgICAgdGl0bGU6IE5hbWUg\
b2YgdGhlIGRhdGFiYXNlIHRvIGJlIHByb3Zpc2lvbmVkIAogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIGRlZmF1bHQ6IHNhbXBsZWRiCiAgICAgIC0gbmFtZTogbXNzcWxfaG9zdAogICAgICAg\
IHRpdGxlOiBIb3N0IHJ1bm5pbmcgTVMgU1FMIFNlcnZlciAKICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgLSBuYW1lOiBtc3NxbF9wb3J0CiAgICAgICAgdGl0bGU6IFBvcnQgTVMgU1FMIFNlcnZl\
ciBpcyBleHBvc2VkIG9uCiAgICAgICAgdHlwZTogaW50IAogICAgICAgIGRlZmF1bHQ6IDE0MzMg\
CiAgICAgIC0gbmFtZTogbXNzcWxfYWRtaW5fdXNlcgogICAgICAgIHRpdGxlOiBNU1NRTCBBZG1p\
biBVc2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVsdDogU0EgCiAgICAgIC0g\
bmFtZTogbXNzcWxfYWRtaW5fcGFzc3dvcmQKICAgICAgICB0aXRsZTogTVNTUUwgQWRtaW4gUGFz\
c3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgLSBuYW1lOiBtc3NxbF91c2VyCiAgICAg\
ICAgdGl0bGU6IERhdGFiYXNlIHVzZXIgdG8gYmUgYWRkZWQgdG8gY29ubmVjdCBpbiB0aGUgZnV0\
dXJlIAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IG1zc3FsdXNlcgogICAg\
ICAtIG5hbWU6IG1zc3FsX3Bhc3N3b3JkCiAgICAgICAgdGl0bGU6IFBhc3N3b3JkIGZvciB0aGUg\
ZGF0YWJhc2UgdXNlciBiZWluZyBhZGRlZAogICAgICAgIGRlZmF1bHQ6IE1TU1FMUGFzc3dvcmQx\
CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgIC0gbmFtZTogcG9zdGluc3RhbGxfbXNzcWxfc2Ny\
aXB0CiAgICAgICAgdGl0bGU6IFVSTCBvZiB0aGUgc2NyaXB0IHRvIHJ1biBhZnRlciBkYXRhYmFz\
ZSBjcmVhdGlvbgogICAgICAgIHR5cGU6IHN0cmluZwo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN rpm -ivh http://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm && yum -y install python-pip && pip install pymssql && yum clean all -y
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
